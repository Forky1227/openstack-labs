---
date: "2016-05-09"
draft: false
weight: 4
title: "Lab 04 - Keystone"
---

|Mon|Mon|Mon|Mon|Tue|Tue|Tue|Tue|Wed|Wed|Wed|Thur|Thur|Thur|Thur|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|[00](/labs/openstack/00/)|[01](/labs/openstack/01/)|[02](/labs/openstack/02/)|[03](/labs/openstack/03/)|![alt text](https://i.imgur.com/mUIVxEm.png "You are here")|[05](/labs/openstack/05/)|[06](/labs/openstack/06/)|[07](/labs/openstack/07/)|[08](/labs/openstack/08/)|[09](/labs/openstack/09/)|[10](/labs/openstack/10/)|[11](/labs/openstack/11/)|[12](/labs/openstack/12/)|[13](/labs/openstack/13/)|[14](/labs/openstack/14/)|

### Lab Duration: 60 minutes

### Lab Objective

The objective of this lab is to further your understanding of OpenStack Identity service (Keystone). Having appropriate credentials is required if you wish to use any CLI tools to query on the OpenStack services.

To use an OpenStack cloud, you need to authenticate against the Identity service Keystone (which returns a Token and the Service Catalog). To request an authentication token, you must supply a payload of credentials in the authentication request. Credentials are usually a combination of your user name and password, and optionally, the name or ID of the tenant in which your cloud runs. When you send API requests, you include the token in an HTTP header called the "X-Auth-Token" header. 

If you access multiple OpenStack services, you must get a token for each service. A token is valid for a limited time before it expires. A token can also become invalid for other reasons. For example, if the roles for a user change, existing tokens for that user are invalid. Credentials allow OpenStack services to determine where your service endpoints and your authentication information are located.

#### 1. Understanding permissions
 
0. SSH to your controller as root, you might use:

 * While holding the control key, click: (https://alta3.com/sshproxy)

0. Once logged into the controller, type the following command (it won't work!):

    `[root@controller ~]#`  `openstack flavor list`

    ```
    ERROR (CommandError): Missing parameter(s):
    Set a username with --os-username, OS_USERNAME, or auth.username
    Set an authentication URL, with --os-auth-url, OS_AUTH_URL or auth.auth_url
    Set a scope, such as a project or domain, set a project scope with --os-project-name, OS_PROJECT_NAME or auth.project_name, set a domain scope with --os-domain-name, OS_DOMAIN_NAME or auth.domain_name
    ```
    
    > This command results in an error because Nova doesn't know who you are.
    - **Q1: When you issued the nova flavor-list command at the CLI, did you identify yourself?**
      - A1: No. We did not identify ourselves to any OpenStack service at the CLI. The root user (root@controller) is a user within the Ubuntu OS, and has nothing to do with OpenStack users, projects, or permissions.
    - **Q2: When you issue commands through Horizon, do you first need to identify yourself?**
      - A2: Yes. Before you can do anything in Horizon, you must first login as a user (admin, aliceanderson, bobbarker, etc.), that identity is cached for the remainder of the session (until you log out of the dashboard). Therefore, if we plan to issue commands at the CLI, we'll need to learn how to pass permissions at the CLI.

0. Let's try another command that **won't** work!

    `[root@controller ~]#` `openstack project list`

    > Another error!? That's alright... Openstack doesn't know who you are. Do you have permissions to view the current tenants?
 
0. We focusing on the permissions required to issue a command successfully without an error. We only chose flavor-list as a example.
    
    `[root@controller ~]#`  `openstack flavor list --os-auth-url http://controller:35357/v3 --os-username admin --os-domain-name default --os-project-name admin --os-password alta3`
	 
    ```
    +----+-----------+-------+------+-----------+-------+-----------+
    | ID | Name      |   RAM | Disk | Ephemeral | VCPUs | Is Public |
    +----+-----------+-------+------+-----------+-------+-----------+
    | 1  | m1.tiny   |   512 |    1 |         0 |     1 | True      |
    | 2  | m1.small  |  2048 |   20 |         0 |     1 | True      |
    | 3  | m1.medium |  4096 |   40 |         0 |     2 | True      |
    | 4  | m1.large  |  8192 |   80 |         0 |     4 | True      |
    | 5  | m1.xlarge | 16384 |  160 |         0 |     8 | True      |
    +----+-----------+-------+------+-----------+-------+-----------+
    ```

    > Now the flavors are displayed. This is because you issued a command that included values of variables that disclose your permissions (os-auth-url --os-username --os-domain-name --os-project-name --os-password). Openstack can use this information to make an API call to the Keystone service and determine if you (admin) have sufficient permissions to execute the command (flavor list)
    > **ID**: Unique ID (integer or UUID) for the flavor.  
      **Name**: A descriptive name, such as xx.size_name, is conventional but not required, though some third-party tools may rely on it.  
      **RAM**: Virtual machine memory in megabytes.  
      **Disk**: Virtual root disk size in gigabytes. This is an ephemeral disk the base image is copied into. You don't use it when you boot from a persistent volume. The "0" size is a special case that uses the native base image size as the size of the ephemeral root volume.  
      **Ephemeral**: Specifies the size of a secondary ephemeral data disk. This is an empty, unformatted disk and exists only for the life of the instance.  
      **VCPUs**: Number of virtual CPUs presented to the instance.  
      **Is_Public**: Boolean value that indicates whether the flavor is available to all users or private. Private flavors do not get the current tenant assigned to them. Defaults to True.  
      **extra_specs**: Additional optional restrictions on which compute nodes the flavor can run on. This is implemented as key-value pairs that must match against the corresponding key-value pairs on compute nodes. Can be used to implement things like special resources (such as flavors that can run only on compute nodes with GPU hardware).  

0. So it worked, but we had to include a long list of credentials. If you'd like, trying using just **openstack flavor list** again (without the --flags). 

    `[root@controller ~]#` `openstack flavor list`

    > Once again, it didn't work. Clearly the credentials are required every time you issue commands to manipulate your Openstack cloud.

0. Use the nova help commands to better understand the credentials:

    > "openstack -h" will display openstack for the nova command
    > "grep" means "display only these lines that contain the following search string"
    > Therefore, "nova -h | grep os-auth-url" means display help, and only display the lines that contain os-auth-url
 
    `[root@controller ~]#` `openstack -h`

    `[root@controller ~]#` `openstack -h | grep os-auth-url`

    `[root@controller ~]#` `openstack -h | grep os-username`

    `[root@controller ~]#` `openstack -h | grep os-project-name`

    `[root@controller ~]#` `openstack -h | grep os-domain-name`

    `[root@controller ~]#` `openstack -h | grep os-password`
    
    > The purpose of issuing these commands is so that you know what the flags are that you are setting
	
0. Let's go a step further and issue the same command, but this time include a debug flag and see if we can deep dive into what is going on!

    `[root@controller ~]# clear` 
    
    `[root@controller ~]#`  `openstack --debug flavor list --os-auth-url http://controller:35357/v3 --os-username admin --os-domain-name default --os-project-name admin --os-password alta3`
    
    > Debug attempts to display the processes that are going on in the background to make this possible. We'll spend some more time checking out some of the returned information in the next lab, for now, we just wanted you to be aware that it was possible.

    ```
    START with options: ['--debug', 'flavor', 'list', '--os-auth-url', 'http://controller:35357/v3', '--os-username', 'admin', '--os-domain-name', 'default', '--os-project-name', 'admin', '--os-password', 'alta3']
    options: Namespace(access_token_endpoint='', auth_type='', auth_url='http://controller:35357/v3', cacert='', client_id='', client_secret='***', cloud='', debug=True, default_domain='default', deferred_help=False, domain_id='', domain_name='default', endpoint='', identity_provider='', identity_provider_url='', insecure=None, interface='', log_file=None, os_baremetal_api_version='1.6', os_clustering_api_version='1', os_compute_api_version='', os_data_processing_api_version='1.1', os_data_processing_url='', os_dns_api_version='2', os_identity_api_version='', os_image_api_version='', os_key_manager_api_version='1', os_network_api_version='', os_object_api_version='', os_orchestration_api_version='1', os_project_id=None, os_project_name=None, os_queues_api_version='1.1', os_volume_api_version='', os_workflow_api_version='2', password='***', profile=None, project_domain_id='', project_domain_name='', project_id='', project_name='admin', protocol='', region_name='', scope='', service_provider_endpoint='', timing=False, token='***', trust_id='', url='', user_domain_id='', user_domain_name='', user_id='', username='admin', verbose_level=3, verify=None)
    defaults: {u'auth_type': 'password', u'compute_api_version': u'2', 'key': None, u'database_api_version': u'1.0', 'api_timeout': None, u'baremetal_api_version': u'1', u'image_api_version': u'2', 'cacert': None, u'image_api_use_tasks': False, u'floating_ip_source': u'neutron', u'orchestration_api_version': u'1', u'interface': None, u'network_api_version': u'2', u'image_format': u'qcow2', u'key_manager_api_version': u'v1', u'metering_api_version': u'2', 'verify': True, u'identity_api_version': u'2.0', u'volume_api_version': u'2', 'cert': None, u'secgroup_source': u'neutron', u'container_api_version': u'1', u'dns_api_version': u'2', u'object_store_api_version': u'1', u'disable_vendor_agent': {}}
    cloud cfg: {'auth_type': 'password', u'compute_api_version': u'2', u'orchestration_api_version': '1', u'database_api_version': u'1.0', 'data_processing_api_version': '1.1', u'network_api_version': u'2', u'image_format': u'qcow2', u'image_api_version': u'2', 'clustering_api_version': '1', 'verify': True, u'dns_api_version': '2', u'object_store_api_version': u'1', 'verbose_level': 3, 'region_name': '', 'api_timeout': None, u'baremetal_api_version': '1.6', 'queues_api_version': '1.1', 'auth': {'username': 'admin', 'project_name': 'admin', 'user_domain_name': 'default', 'auth_url': 'http://controller:35357/v3', 'password': '***', 'project_domain_name': 'default'}, 'default_domain': 'default', u'container_api_version': u'1', u'image_api_use_tasks': False, u'floating_ip_source': u'neutron', 'key': None, 'timing': False, 'cacert': None, u'key_manager_api_version': '1', u'metering_api_version': u'2', 'deferred_help': False, u'identity_api_version': u'2.0', 'workflow_api_version': '2', u'volume_api_version': u'2', 'cert': None, u'secgroup_source': u'neutron', 'debug': True, u'interface': None, u'disable_vendor_agent': {}}
    compute API version 2, cmd group openstack.compute.v2
    network API version 2, cmd group openstack.network.v2
    image API version 2, cmd group openstack.image.v2
    volume API version 2, cmd group openstack.volume.v2
    identity API version 2.0, cmd group openstack.identity.v2
    object_store API version 1, cmd group openstack.object_store.v1
    dns API version 2, cmd group openstack.dns.v2
    baremetal API version 1.6, cmd group openstack.baremetal.v1
    data_processing API version 1.1, cmd group openstack.data_processing.v1
    messaging API version 1.1, cmd group openstack.messaging.v1
    orchestration API version 1, cmd group openstack.orchestration.v1
    clustering API version 1, cmd group openstack.clustering.v1
    workflow_engine API version 2, cmd group openstack.workflow_engine.v2
    key_manager API version 1, cmd group openstack.key_manager.v1
    command: flavor list -> openstackclient.compute.v2.flavor.ListFlavor
    Auth plugin password selected
    auth_type: password
    Using auth plugin: password
    Using parameters {'username': 'admin', 'project_name': 'admin', 'auth_url': 'http://controller:35357/v3', 'user_domain_name': 'default', 'password': '***', 'project_domain_name': 'default'}
    Get auth_ref
    REQ: curl -g -i -X GET http://controller:35357/v3 -H "Accept: application/json" -H "User-Agent: python-openstackclient keystoneauth1/2.4.1 python-requests/2.9.1 CPython/2.7.12"
    Starting new HTTP connection (1): controller
    "GET /v3 HTTP/1.1" 200 250
    RESP: [200] Content-Length: 250 Vary: X-Auth-Token Keep-Alive: timeout=5, max=100 Server: Apache/2.4.18 (Ubuntu) Connection: Keep-Alive Date: Fri, 19 Aug 2016 20:13:26 GMT x-openstack-request-id: req-87fb33a0-2b3b-4050-bc00-2a718ee8562a Content-Type: application/json X-Distribution: Ubuntu
    RESP BODY: {"version": {"status": "stable", "updated": "2016-04-04T00:00:00Z", "media-types": [{"base": "application/json", "type": "application/vnd.openstack.identity-v3+json"}], "id": "v3.6", "links": [{"href": "http://controller:35357/v3/", "rel": "self"}]}}

    Making authentication request to http://controller:35357/v3/auth/tokens
    "POST /v3/auth/tokens HTTP/1.1" 201 5362
    run(Namespace(all=False, columns=[], formatter='table', limit=None, long=False, marker=None, max_width=0, noindent=False, public=True, quote_mode='nonnumeric'))
    Instantiating compute client for VAPI Version Major: 2, Minor: 0
    Making authentication request to http://controller:35357/v3/auth/tokens
    "POST /v3/auth/tokens HTTP/1.1" 201 5362
    REQ: curl -g -i -X GET http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/detail -H "User-Agent: python-novaclient" -H "Accept: application/json" -H "X-Auth-Token: {SHA1}8c00d8a5775c2c5e3df7aae945dd77960f1b11c3"
    Starting new HTTP connection (1): controller
    "GET /v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/detail HTTP/1.1" 200 2079
    RESP: [200] Content-Length: 2079 X-Compute-Request-Id: req-6456c1b0-4fa1-4eff-b7c9-ba560c382855 Vary: X-OpenStack-Nova-API-Version Connection: keep-alive X-Openstack-Nova-Api-Version: 2.1 Date: Fri, 19 Aug 2016 20:13:27 GMT Content-Type: application/json
    RESP BODY: {"flavors": [{"name": "m1.tiny", "links": [{"href": "http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/1", "rel": "self"}, {"href": "http://controller:8774/1bc66b9ab9a24814bba5438d2db74147/flavors/1", "rel": "bookmark"}], "ram": 512, "OS-FLV-DISABLED:disabled": false, "vcpus": 1, "swap": "", "os-flavor-access:is_public": true, "rxtx_factor": 1.0, "OS-FLV-EXT-DATA:ephemeral": 0, "disk": 1, "id": "1"}, {"name": "m1.small", "links": [{"href": "http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/2", "rel": "self"}, {"href": "http://controller:8774/1bc66b9ab9a24814bba5438d2db74147/flavors/2", "rel": "bookmark"}], "ram": 2048, "OS-FLV-DISABLED:disabled": false, "vcpus": 1, "swap": "", "os-flavor-access:is_public": true, "rxtx_factor": 1.0, "OS-FLV-EXT-DATA:ephemeral": 0, "disk": 20, "id": "2"}, {"name": "m1.medium", "links": [{"href": "http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/3", "rel": "self"}, {"href": "http://controller:8774/1bc66b9ab9a24814bba5438d2db74147/flavors/3", "rel": "bookmark"}], "ram": 4096, "OS-FLV-DISABLED:disabled": false, "vcpus": 2, "swap": "", "os-flavor-access:is_public": true, "rxtx_factor": 1.0, "OS-FLV-EXT-DATA:ephemeral": 0, "disk": 40, "id": "3"}, {"name": "m1.large", "links": [{"href": "http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/4", "rel": "self"}, {"href": "http://controller:8774/1bc66b9ab9a24814bba5438d2db74147/flavors/4", "rel": "bookmark"}], "ram": 8192, "OS-FLV-DISABLED:disabled": false, "vcpus": 4, "swap": "", "os-flavor-access:is_public": true, "rxtx_factor": 1.0, "OS-FLV-EXT-DATA:ephemeral": 0, "disk": 80, "id": "4"}, {"name": "m1.xlarge", "links": [{"href": "http://controller:8774/v2.1/1bc66b9ab9a24814bba5438d2db74147/flavors/5", "rel": "self"}, {"href": "http://controller:8774/1bc66b9ab9a24814bba5438d2db74147/flavors/5", "rel": "bookmark"}], "ram": 16384, "OS-FLV-DISABLED:disabled": false, "vcpus": 8, "swap": "", "os-flavor-access:is_public": true, "rxtx_factor": 1.0, "OS-FLV-EXT-DATA:ephemeral": 0, "disk": 160, "id": "5"}]}

    +----+-----------+-------+------+-----------+-------+-----------+
    | ID | Name      |   RAM | Disk | Ephemeral | VCPUs | Is Public |
    +----+-----------+-------+------+-----------+-------+-----------+
    | 1  | m1.tiny   |   512 |    1 |         0 |     1 | True      |
    | 2  | m1.small  |  2048 |   20 |         0 |     1 | True      |
    | 3  | m1.medium |  4096 |   40 |         0 |     2 | True      |
    | 4  | m1.large  |  8192 |   80 |         0 |     4 | True      |
    | 5  | m1.xlarge | 16384 |  160 |         0 |     8 | True      |
    +----+-----------+-------+------+-----------+-------+-----------+
    clean_up ListFlavor:
    END return value: 0
    ```

#### 2. Getting User Credentials (source keystonerc_admin)

So what we've all figured out by this point, is that setting flag on every CLI command involves far too much typing. Let's make our commands easier to issue by setting some environmental variables for our current bash session.  NOTE: If environmental vs shell variables, and parent vs child sessions are new terms for you, that is OK. There is a small section at the conclusion of this lab that will make it more clear.


0. Display the contents of the `keystonerc_admin` file

    `[root@controller ~]#` 	`cat keystonerc_admin`

    > Comments have been added to the output, your output will lack the comments (lines that begin with #).

    ```
    export OS_PROJECT_DOMAIN_NAME=default
    export OS_USER_DOMAIN_NAME=default
    export OS_PROJECT_NAME=admin
    export OS_USERNAME=admin
    export OS_PASSWORD=alta3
    export OS_AUTH_URL=http://controller:35357/v3
    export OS_IDENTITY_API_VERSION=3
    export OS_IMAGE_API_VERSION=2
    # Appends the CLI prompt with keystone_admin
    export PS1='[\u@\h \W(keystone_admin)]\$ '
    ```
    
    > The export commands within this file will mark each VAR for automatic export to the environment of subsequently executed commands (i.e. make the local shell variable VAR global). Essentially, we can set all of our permissions in this file, source this file, and then not have to ever type our permissions again as they'll always be available to the bash environment.
    >
    > NOTE: The name of this file may change slightly depending on your environment. RDO deployments use the formatting structure keystonerc_$USER
    > 
    > For more info on regions: http://docs.openstack.org/openstack-ops/content/scaling.html#segregate_cloud

0. Display a list of the environmental variables currently set

   `[root@controller ~]#` `printenv | sort`
    
   > Look over the displayed entries. Do you see any mention of the aforementioned credentials, such as `OS_PROJECT_NAME` or `OS_USERNAME`?

   ```
   XDG_SESSION_ID=16
   HOSTNAME=controller.localdomain
   SELINUX_ROLE_REQUESTED=
   TERM=screen
   SHELL=/bin/bash
   HISTSIZE=1000
   SSH_CLIENT=71.251.147.235 52298 22
   SELINUX_USE_CURRENT_RANGE=
   SSH_TTY=/dev/pts/0
   USER=root
   LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=3
   ;43:ca=30;41:tw=30;42:ow=34
   ;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.t
   zo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.
   tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7
   z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=
   01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.og
   m=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=
   01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;3
   6:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:
   *.xspf=01;36:
   MAIL=/var/spool/mail/root
   PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
   PWD=/root
   LANG=en_US.UTF-8
   SELINUX_LEVEL_REQUESTED=
   HISTCONTROL=ignoredups
   SHLVL=1
   HOME=/root
   LOGNAME=root
   SSH_CONNECTION=71.251.147.235 52298 192.168.0.10 22
   LESSOPEN=||/usr/bin/lesspipe.sh %s
   XDG_RUNTIME_DIR=/run/user/0
   _=/usr/bin/printenv
   ```
	
3. Set the environmental variables found in **admin-openrc**

    `[root@controller ~]#` `source admin-openrc`
    
    > This is a bash shell built-in command that executes the content of the file passed as a argument in the current shell. It is synonymous with ' . ' (period). After executing the above command, the CLI line will change. This is just a reminder that you are now passing commands to the OpenStack services as some user (in this case admin).
    > 
    > Notice that your CLI prompt has changed to indicate that you are now 'sourced' with admin permissions

	```
	[root@controller ~(keystone_admin)]#
    ```
 
4. Once again, display a list of the environmental variables currently set.

    `[root@controller ~(keystone_admin)]#` `printenv`
    
    > Look over the displayed entries. Now you will see a listing for the variables contained within `admin-openrc`, such as `OS_PROJECT_NAME` and `OS_USERNAME`.
    > Just for your understanding, these entries are only set for this current bash session. If you type exit, then reconnect as root, these variables will unset themselves. If you want to remove them manually, use the `unset` command. For fun, try running `printenv | grep OS_`
	
	```
	XDG_SESSION_ID=16
	HOSTNAME=controller.localdomain
	SELINUX_ROLE_REQUESTED=
	TERM=screen
	SHELL=/bin/bash
	HISTSIZE=1000
	SSH_CLIENT=71.251.147.235 52298 22
	OS_REGION_NAME=RegionOne   <-------------------
	SELINUX_USE_CURRENT_RANGE=
	SSH_TTY=/dev/pts/0
	USER=root
	LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34
	;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.t
	zo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.
	tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7
	z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=
	01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.og
	m=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=
	01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;3
	6:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:
	*.xspf=01;36:
	MAIL=/var/spool/mail/root
	PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
	PWD=/root
	OS_PASSWORD=alta3  <-----------------
	LANG=en_US.UTF-8
	PS1=[\u@\h \W(keystone_admin)]\$
	SELINUX_LEVEL_REQUESTED=
	OS_AUTH_URL=http://192.168.0.10:5000/v2.0/
	HISTCONTROL=ignoredups
	OS_USERNAME=admin  <-------------------
	SHLVL=1
	HOME=/root
	OS_TENANT_NAME=admin  <----------------------
	LOGNAME=root
	SSH_CONNECTION=71.251.147.235 52298 192.168.0.10 22
	LESSOPEN=||/usr/bin/lesspipe.sh %s
	XDG_RUNTIME_DIR=/run/user/0
	_=/usr/bin/printenv
    ```

5. Flex your new admin environmental-variable-given powers 

	  `[root@controller ~(keystone_admin)]#` `openstack flavor list`
    
    > This time it should just work without having to type the extra permissions. Try executing a few more commands to the other OpenStack services as well.
	
	```
	+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
	| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
	+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
	| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |
	| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |
	| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |
	| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |
	| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |
	+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
    ```

6. Issue a few more commands. 
	
    `[root@controller ~(keystone_admin)]#` `openstack project create temp_project --domain default`

    `[root@controller ~(keystone_admin)]#` `openstack project list`
	
#### 3. Creating a **keystonerc_chestercopperpot** file for Chester Copperpot of Vault Tek

Remember our buddy Chester Copperpot of Vault Tek? You should see him when you issued the previous command keystone user-list.

Let's make it easy for us to execute OpenStack commands as Chester Copperpot who is part of the project `vault_tek` at the CLI.

1. To make sure we're all on the same page, set the environmental variables found in `keystonerc_admin`

    `[root@controller ~(keystone_admin)]#` `source keystonerc_admin`

2. List the keystone users

    `[root@controller ~(keystone_admin)]#` `keystone user-list`

    ```
    +----------------------------------+------------------+---------+---------------------------+
    |                id                |       name       | enabled |           email           |
    +----------------------------------+------------------+---------+---------------------------+
    | e9483918caa940a48fe882ba092c7e0b |      admin       |   True  |       root@localhost      |
    | 5bbecabeb2a74aff9dc27f9a8675de45 |  aliceanderson   |   True  |                           |
    | 641761fe08b74a42b2b3497a38f06020 |    bobbarker     |   True  |                           |
    | 9b1f9b36d7354b1ea121ccfbae339d8b |    ceilometer    |   True  |    ceilometer@localhost   |
    | 5b1e70851c2e451c8c0848f60b338e90 | chestercopperpot |   True  | chester@vault_tek.example |
    | e96c13b017b341a79808ebc9f04afa98 |      cinder      |   True  |      cinder@localhost     |
    | 92b130a947e342adb476431b041ed43c |       demo       |   True  |                           |
    | f02ffa49234a401d8461406c5ef5780d |     gandalf      |   True  |  gandalf@theshire.example |
    | 6146821b56ed4ca18f82b0f90afd278c |      glance      |   True  |      glance@localhost     |
    | ff5f550ecf064e65bd45d2d0b91bbdab |     neutron      |   True  |     neutron@localhost     |
    | d3125ab7d2eb4ba0a23d480eee988419 |       nova       |   True  |       nova@localhost      |
    | 4c8da8951ad34d4498d534e2efb842ec |      swift       |   True  |      swift@localhost      |
    +----------------------------------+------------------+---------+---------------------------+
    ```

	
3. Look at the user chestercopperpot, and note his tenantID

    `[root@controller ~(keystone_admin)]#` `keystone user-get chestercopperpot`

    ```
    +----------+----------------------------------+
    | Property |              Value               |
    +----------+----------------------------------+
    |  email   |    chester@vault_tek.example     |
    | enabled  |               True               |
    |    id    | 5b1e70851c2e451c8c0848f60b338e90 |
    |   name   |         chestercopperpot         |
    | tenantId | 5ca9bad4f0e94b2eb0fac330dff988d9 |
    | username |         chestercopperpot         |
    +----------+----------------------------------+
    ```
	
4. Find the tenant name for chester's tenantID value by comparing the tenantID above with the id below (should be vault_tek)
   
    `[root@controller ~(keystone_admin)]#`  `keystone tenant-list`

    ```
    +----------------------------------+-------------+---------+
    |                id                |     name    | enabled |
    +----------------------------------+-------------+---------+
    | edb80920a0e84fbb85372d50a18e8d98 |   acme_inc  |   True  |
    | 300b2cc45c3846939e589310ae714e46 |    admin    |   True  |
    | a9c27d47441e432c8529f8f30ea3261e |     demo    |   True  |
    | 85a11a1515f94848be7aa5b56adec8bf |   services  |   True  |
    | 5e244f171df344cebc2bcce91fc90d96 | temp_tenant |   True  |
    | 5005fe4c52144d1299fddb9cfc1f9b48 |  the_shire  |   True  |
    | 5ca9bad4f0e94b2eb0fac330dff988d9 |  vault_tek  |   True  | <- UUID of vault_tek
    +----------------------------------+-------------+---------+
    ```

5. While we are on a roll, lets try a few additional commands. Lets use tenant-get to discover the name if we only know the id!

    `[root@controller ~(keystone_admin)]#`  `keystone tenant-get 5ca9bad4f0e94b2eb0fac330dff988d9`  <-- Put YOUR UUID of vault_tek here!!!

    ```
    +-------------+----------------------------------+
    |   Property  |              Value               |
    +-------------+----------------------------------+
    | description |                                  |
    |   enabled   |               True               |
    |      id     | 5ca9bad4f0e94b2eb0fac330dff988d9 |
    |     name    |            vault_tek             |
    +-------------+----------------------------------+
    ```

6. Yet another way, suppose we only know the tenant name, not the id.

    `[root@controller ~(keystone_admin)]#`  `keystone tenant-get vault_tek`

    ```
    +-------------+----------------------------------+
    |   Property  |              Value               |
    +-------------+----------------------------------+
    | description |                                  |
    |   enabled   |               True               |
    |      id     | 5ca9bad4f0e94b2eb0fac330dff988d9 |
    |     name    |            vault_tek             |
    +-------------+----------------------------------+
    ```

7. Make a copy of the keystonerc_admin file, then open it in nano so we can edit it.

    `(keystone_admin)#` `cp keystonerc_admin keystonerc_chestercopperpot`

8. Throughout the rest of the lab, you may use either **nano** or **vim**.

    **nano:**

    `(keystone_admin)#` `nano keystonerc_chestercopperpot`

    **vim:** 

    `(keystone_admin)#` `vim keystonerc_chestercopperpot`


9. Edit **keystonerc_chestercopperpot** so it looks like the following. 

    <pre>
    export OS_USERNAME=chestercopperpot
    export OS_TENANT_NAME=vault_tek
    export OS_PASSWORD=fa5tpa55w0rd
    export OS_AUTH_URL=http://192.168.0.10:5000/v2.0/
    export OS_REGION_NAME=RegionOne
    export PS1='[\u@\h \W(keystone_chestercopperpot)]\$ '
    </pre>

	> **Nano hints:**  
         When you're done editing changes, do the following:  
	 press CTRL + O (to write out aka save)  
	 press ENTER (to confirm save)  
	 press CTRL + X (to exit) 
 
10. Display the contents of **keystonerc_chestercopperpot** and verify that they are correct.

    `[root@controller ~(keystone_admin)#` `cat keystonerc_chestercopperpot`

11. Set global variables in the current shell to correspond with the user chestercopperpot, then check the results... notice anything that begins OS_ is now a reflection of chestercopperpot. 

    `[root@controller ~(keystone_admin)#` `source keystonerc_chestercopperpot`
	
    `[root@controller ~(keystone_chestercopperpot)#` `printenv | grep OS_`
	
    <pre>
    OS_USERNAME=chestercopperpot
    OS_TENANT_NAME=vault_tek
    OS_PASSWORD=fa5tpa55w0rd
    OS_AUTH_URL=http://192.168.0.10:5000/v2.0/
    OS_REGION_NAME=RegionOne
    </pre>

12. Note the CLI changed. Run commands and see how the results differ from chester's perspective.

    `[root@controller ~(keystone_chestercopperpot)#` `nova flavor-list`
	
	> OK, this worked!

    `[root@controller ~(keystone_chestercopperpot)#` `keystone tenant-list`
    
    > This should result in an HTTP 403 failure, as the user chestercopperpot does not have sufficient permissions to issue this keystone command.

13. Let's repeat the process for the user aliceanderson

    `[root@controller ~(keystone_chestercopperpot)#` `cp keystonerc_admin keystonerc_aliceanderson`

    **Use the editor (nano or vim) of your choice to edit the file.**

    **nano:**   `[root@controller ~(keystone_chestercopperpot)#` `nano keystonerc_aliceanderson`  
    **vim:**    `[root@controller ~(keystone_chestercopperpot)#` `vim keystonerc_aliceanderson`  
	
14. Edit **keystonerc_aliceanderson** so it looks like the following (or copy and paste is fine):

    <pre>
    export OS_USERNAME=aliceanderson
    export OS_TENANT_NAME=acme_inc
    export OS_PASSWORD=fa5tpa55w0rd
    export OS_AUTH_URL=http://192.168.0.10:5000/v2.0/   
    export OS_REGION_NAME=RegionOne
    export PS1='[\u@\h \W(keystone_aliceanderson)]\$ '
    </pre>
	
	> **Nano hints:**  
         When you're done editing changes, do the following:  
	 press CTRL + O (to write out aka save)  
	 press ENTER (to confirm save)  
	 press CTRL + X (to exit)
	
15. Display the contents of **keystonerc_aliceanderson** and verify that they are correct

    `[root@controller ~(keystone_chestercopperpot)#` `cat keystonerc_aliceanderson`
	
16. Finally, lets repeat the process again for user bobbarker, using the editor of your choice.c

    `[root@controller ~(keystone_chestercopperpot)#` `cp keystonerc_admin keystonerc_bobbarker`

    **nano:**  `[root@controller ~(keystone_chestercopperpot)#` `nano keystonerc_bobbarker`  
    **vim:**  `[root@controller ~(keystone_chestercopperpot)#` `vim keystonerc_bobbarker`  
	
17. Edit **keystonerc_bobbarker** so it looks like the following (copy and paste is fine):

    <pre>
    export OS_USERNAME=bobbarker                       
    export OS_TENANT_NAME=acme_inc   
    export OS_PASSWORD=fa5tpa55w0rd          
    export OS_AUTH_URL=http://192.168.0.10:5000/v2.0/  
    export OS_REGION_NAME=RegionOne
    export PS1='[\u@\h \W(keystone_bobbarker)]\$ '     
    </pre>
	
	> **Nano hints:**  
         When you're done editing changes, do the following:  
	 press CTRL + O (to write out aka save)  
	 press ENTER (to confirm save)  
	 press CTRL + X (to exit)  

18. Display the contents of **keystonerc_bobbarker** and verify that they are correct

    `[root@controller ~(keystone_chestercopperpot)#` `cat keystonerc_bobbarker`

#### 4. Using the OpenStack Horizon Dashboard to assist in creating a keystonerc file for new user Doris Day of Vault Tek 

1. Log in to the OpenStack Horizon Dashboard as `chestercopperpot` // `fa5tpa55w0rd`

2. Click on **Project > Compute > Access & Security**

3. Click on the tab **API Access**

4. In the upper right corner, click on the button **Download OpenStack RC File**

    ![enter image description here](https://i.imgur.com/YUdErel.png)

5. This file will download to your browser's download folder. This file is just for your own reference, but take a moment to open it in your favorite text editor and read it over. The file you open will look similar to the one shown below. Again, reading over this file is just an FYI / reference step. Just a recommendation, if your "favorite" text editor is Microsoft Notepad or Microsoft Word, then it is recommended you take 2 minutes and go [download Notepad++](https://notepad-plus-plus.org/download/v6.8.2.html). It is a great utility for quickly editing simple text files.

	```
    bash
    #!/bin/bash
    # To use an OpenStack cloud you need to authenticate against the Identity
    # service named keystone, which returns a **Token** and **Service Catalog**.
    # The catalog contains the endpoints for all services the user/tenant has
    # access to - such as Compute, Image Service, Identity, Object Storage, Block
    # Storage, and Networking (code-named nova, glance, keystone, swift,
    # cinder, and neutron).
    #
    #
    # *NOTE*: Using the 2.0 *Identity API* does not necessarily mean any other
    # OpenStack API is version 2.0. For example, your cloud provider may implement
    # Image API v1.1, Block Storage API v2, and Compute API v2.0. OS_AUTH_URL is
    # only for the Identity API served through keystone.
    export OS_AUTH_URL=http://192.168.0.10:5000/v2.0
    #
    #
    # With the addition of Keystone we have standardized on the term **tenant**
    # as the entity that owns the resources.
    export OS_TENANT_ID=57dc930957f243438e532163269138d1
    export OS_TENANT_NAME="vault_tek"
    export OS_PROJECT_NAME="vault_tek"
    #
    #
    # In addition to the owning entity (tenant), OpenStack stores the entity
    # performing the action as the **user**.
    export OS_USERNAME="chestercopperpot"
    #
    #    #    #    #  LOOK AT THIS     #    #    #    #
    # With Keystone you pass the keystone password.
    echo "Please enter your OpenStack Password: "
    read -sr OS_PASSWORD_INPUT
    export OS_PASSWORD=$OS_PASSWORD_INPUT
    #    #    #    # END LOOK AT THIS  #    #    #    #
    #
    # If your configuration has multiple regions, we set that information here.
    # OS_REGION_NAME is optional and only valid in certain environments.
    export OS_REGION_NAME="RegionOne"
    #
    #
    # Don't leave a blank variable, unset it if it was empty
    if [ -z "$OS_REGION_NAME" ]; then unset OS_REGION_NAME; fi
    ```
 
    >This file is a bit fancier than the previous one we studied, but it is well commented. There are two key differences between this file and ours:
    >
    > 1) The first is that this file will require the user to enter their password instead of storing it locally as plain-text. In production, this is desirable, as asking users to enter their password will prevent admins from having to manage security and permissions on user files because they contain plain-text passwords.
	>
    > 2) The second difference is that this file also sets some additional environmental variables, which could be problematic, as our other keystonerc_.* files do NOT set these variables. If we source back to another user without first unsetting these variables, we might get ourselves into trouble. So instead of using this file, let's just borrow the piece of code that asks the user for the password. It is shown below for reference:

    ```
    # With Keystone you pass the keystone password. 
    echo "Please enter your OpenStack Password: "
    read -sr OS_PASSWORD_INPUT
    export OS_PASSWORD=$OS_PASSWORD_INPUT
    ```
	
6. We're done in Horizon for now. Return to your SSH session with the controller and source keystone_admin

    `[root@controller ~]#` `source keystonerc_admin`

7. Let's create a new user (Doris Day) within the vault_tek project (tenant) and then create a source file that prompts for a password.

    `[root@controller ~(keystone_admin)]#` `keystone user-create --name dorisday --tenant vault_tek --pass fa5tpa55w0rd --email dorisday@vault_tek.example`

	```
	+----------+----------------------------------+
	| Property |              Value               |
	+----------+----------------------------------+
	|  email   |    dorisday@vault_tek.example    |
	| enabled  |               True               |
	|    id    | 8086288736dc4147bf38ffaf07acd9b5 |	
	|   name   |             dorisday             |
	| tenantId | 8f6d4710d774466f96858af6fa69aaa3 |
	| username |             dorisday             |
	+----------+----------------------------------+
    ```
	
8. Create a file we can source for Doris Day of Vault Tek.

    **nano:**  `[root@controller ~(keystone_admin)]#` `nano keystonerc_dorisday`  
    **vim**  `[root@controller ~(keystone_admin)]#` `vim keystonerc_dorisday`

9. Edit `keystonerc_dorisday` so it looks like the following:

    <pre>
    export OS_USERNAME=dorisday
    export OS_TENANT_NAME=vault_tek
    echo "Please enter your OpenStack Password: "   
    read -sr OS_PASSWORD_INPUT
    export OS_PASSWORD=$OS_PASSWORD_INPUT
    export OS_AUTH_URL=http://192.168.0.10:5000/v2.0/
    export OS_REGION_NAME=RegionOne
    export PS1='[\u@\h \W(keystone_dorisday)]\$ '
    </pre>
	
	> **Nano hints:**  
         When you're done editing changes, do the following:  
	 press CTRL + O (to write out aka save)  
	 press ENTER (to confirm save)  
	 press CTRL + X (to exit)  

10. Confirm that the file was saved correctly, by displaying the output with cat, and then source keystonerc_dorisday

    `[root@controller ~(keystone_admin)]#` `source keystonerc_dorisday`

    `Please enter your OpenStack Password:` `fa5tpa55w0rd`

    - **Q1: Is this mechanism, prompting for a password, more secure? Why or why not?**
      - Q1: In theory, yes. A user being prompted for a password is more secure than letting a password sit in a plain text document where proper read permissions and encryption may or may not be applied. Regardless, anytime the **export** command is used to set an environmental variable in a linux shell, securing that shell session should be a primary concern. 
	
11. Make sure the file works. Test by issuing a CLI command requiring authentication.

    `[root@controller ~(keystone_dorisday)]#` `nova flavor-list`
    
    > If output like this is displayed, then it worked!

	```
	+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
    | ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
    +----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
    | 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |
    | 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |
    | 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |
    | 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |
    | 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |
    +----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
    ```
	
	> Great job! You are all done with this lab. If you are done early, go onto the next section. It will teach you a little bit more about what is going on when you run the `source` command. 

#### 5. OPTIONAL: Linux variables

In OpenStack, we learned that we could type out the `--os-tenant-name`, `--os-user-name`, `--os-password`, and `--os-auth-url` along with every command, or we could set these values so they persist. If you are not a master of the CLI, you might be curious about how this worked! Understanding how it works might also help you in troubleshooting. After all, what if you ran a source file (set environmental variables), and wish you could un-run that source file (unset environmental variables). 

Variables can be of two basic types: shell variables, or environmental variables. Shell variables are only available within the current session, whereas environmental variables are available to the current session, as well as any spawned sessions. What is a session? You're in one right now. The Bash shell that you are sitting at is a 'session'. If you were to type `bash`, you'd launch another session that would be considered a 'child' session, where your current session would be the 'parent'.

If a child session is spawned by a parent session, environmental variables will be made available to the child sessions, whereas a shell variable will not. To better understand the difference, perform this quick procedure; define a shell variable, and then an environmental variable within parent and child bash shells.

1. Create a shell variable within the current session. Convention says it should be all caps. Because the string we've defined includes a bang, we are using single quotes to surround 'Hello OpenStack!'.

    `[root@controller ~]#` `LEARNING_VAR='Hello OpenStack!'`
	
2. Great! We can confirm that this is a shell variable that will not be passed down to child processes by grepping within output from set

    `[root@controller ~]#` `set | grep LEARNING_VAR`
	
3. LEARNING_VAR='Hello OpenStack!' should be displayed. Now confirm it is NOT an environmental variable by performing the same procedure with printenv.

    `[root@controller ~]#` `printenv | grep LEARNING_VAR`
	
    > No output should be returned, as printenv will only print environmental variables.

4. Let's take a moment to demonstrate how to access any shell or environmental variable. When the shell encounters a `$` sign, it takes it to mean that it should substitute the value of the variable when it comes across it. Type the following command.

    `[root@controller ~]#` `echo $LEARNING_VAR`

    > The string Hello OpenStack! should be displayed.

5. If you type 'bash', you'll spawn a child shell. Think of this as accessing a 'shell within a shell'. Within this child session our variable, `$LEARNING_VAR`, should not be available.

    `[root@controller ~]#` `bash`

    `[root@controller ~]#` `echo $LEARNING_VAR`

    > No output should be displayed. 
    > Hopefully, why no output was display is clear. This is a child session, and was not passed the previous shell variables. Remember, shell variables are only good for the current shell. Type the following to test this assertion.
	
6. Type exit to close the child session and return to the original session.

    `[root@controller ~]#` `exit`

    `[root@controller ~]#` `echo $LEARNING_VAR`
	
    > Once again, the string Hello OpenStack! should be displayed, as we have returned to the parent shell (the shell we started in).

7. Okay. So to recap, LEARNING_VAR is currently a shell variable, but we can make it an environmental variable by using the export command. Let's also change the value of $LEARNING_VAR from `Hello OpenStack!` to `OpenStack Hello!`.

    `[root@controller ~]#` `export LEARNING_VAR='OpenStack Hello!'`

    `[root@controller ~]#` `printenv | grep LEARNING_VAR`
	
8. Now, let us run the same experiment and observe our minor change. Once again, spawn a child shell.

    `[root@controller ~]#` `bash`

    `[root@controller ~]#` `echo $LEARNING_VAR`
 
    > `OpenStack Hello!` should be displayed. 

9. Confirm that it is still set as an environmental variable.

    `[root@controller ~]#` `printenv | grep LEARNING_VAR`
	
10. Now let's set an environmental variable from within our current child shell.

    `[root@controller ~]#` `export NEW_LEARNING_VAR='Bonjour OpenStack!'`
	
11. Issue the following commands to confirm that it was indeed set as an environmental variable. Then exit the child session, and return to the parent shell.

    `[root@controller ~]#` `printenv | grep NEW_LEARNING_VAR`

    `[root@controller ~]#` `exit`

12. Now see if the environmental variable NEW_LEARNING_VAR is still available.

    `[root@controller ~]#` `printenv | grep NEW_LEARNING_VAR`
   
    > No output is returned. This is because `NEW_LEARNING_VAR` was an environmental variable set in the child shell. Emphasis on the word 'was', because when we exited our child shell, that environmental variable was destroyed.

13. The original variable, LEARNING_VAR can be changed back into a shell variable (demoted), by using export and the -n flag.

    `[root@controller ~]#` `export -n LEARNING_VAR`

14. Test that it is no longer a global variable, but still a shell variable

    `[root@controller ~]#` `printenv | grep LEARNING_VAR`

    > No output will be shown as LEARNING_VAR is no longer an environmental variable.

    `[root@controller ~]#` `echo $LEARNING_VAR`

    > OpenStack Hello! should be displayed, as LEARNING_VAR is now a shell variable.
    
    `[root@controller ~]#` `set | grep LEARNING_VAR`
    
    > `LEARNING_VAR='OpenStack Hello!'` will be displayed, confirming `LEARNING_VAR` exists as a shell variable.

16. A shell and environmental variable can be completely removed by issuing the unset command.

    `[root@controller ~]#` `unset LEARNING_VAR`

    `[root@controller ~]#` `echo $LEARNING_VAR`

    > Nothing will be displayed, as `LEARNING_VAR` has been unset

  	`[root@controller ~]#` `set | grep LEARNING_VAR`
	
    > Nothing will be displayed.  

