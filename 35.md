---
date: "2016-11-02"
draft: false
weight: 350
title: "Lab 35 - Launching Instances with Key Pairs"
---
[Click here to find out more about Alta3 Research's Openstack Training](https://alta3.com/courses/openstack)

### TUESDAY - &#x2B50;REQUIRED&#x2B50;

### Lab Objective
The objective of this lab is to describe how key-pairs are implimented within cloud environments to provide a connection that makes logging into an instance both easy and **very** secure. SSH key-pairs are asymmetric cryptography that involve the simultaneous creation of two keys, one is secret (private), and the other is public.

**User Private Key** is kept secret by the SSH user on his client machine (think of this as the 'password'). The user must **NEVER** reveal the private key to anyone, including the system admin, or their identity is compromised.

**User Public Key** is registered to the server the user is trying to access. In order to make the private key work, your public key must be installed onto your instance prior to being able to log into it.

### Procedure

0. From your remote desktop, open a terminal session, and move to the student home directory.

    `student@beachhead:/$` `cd`

0. Change directory to `.ssd`

    `student@beachhead:~$` `cd .ssd`

0. List the contents of the directory

    `student@beachhead:~$` `ll`

0. You will see four files:*

    - **authorized_keys** - are public keys from other users that are authorized to access your machine.  
    
    - **config** - An extremely handy list of shortcuts to SSH into other systems. Adding more hosts to this list makes it easy to navigate your cloud.
    
    - **id_rsa** is your private key. Give this key to no one and remember to keep it secure.
    
    - **id_rsa_pub** - This is your public key, which you will want to copy into your new instances so you can easily connect to them.
    
    - **KEY-PAIR:** Your **id_rsa** and your **id_rsa_pub** are a matched set. They go together. When you connect to an instance, these two files are the "key-pair" we are talking about. 

0. Run the cat command on your public key. It will look like this:
    
    `student@beachhead:~$` `cat id_rsa_pub`

    >
    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC0uAYWJ7pR8kz5Zar8wyQ9LAmzotuU70Q5M2TIMTmJ6Xsof046VcyHEOE3ZlboTHxrDpvjpstmhorkheHwl5IghZnUsQ9+YIcGsk6ds7n2mQ+b52E116b1Ewy7Ihj5UscguhOhsX95rhQx0c3sBl3dmqBsqj0h2P3C8d2HHDy3VyuLcHwosneegle8H5oM7U35VWFwdyyrAEEkSepCc9ENk2rjbKgeQX6d/5pQ5mcoogB15TmpleebgDQkpwzwHRpUqQqZDtVkgqyP9QlhjqfclcRKk6wFdYFplowkussCpn3aRrlPUjnEykWvNwNIBihiBqSjIJmWiU9ZMX5NZu5P1

0. Using your mouse, highlight **your** key from **your** terminal, click-click, and copy.

0. Within Compute, select **Access & Security**

0. Select **Key Pairs**

0. Select **Import Key Pair**

0. Enter the name **student-key** in the Key Pair Name

0. Paste the key you copied from **id_rsa_pub**

0. Click **Import Key Pair**

0. Click **Instances**

0. Launch an instance

0. Perform steps 13 - 30 below


0. Within the remote desktop, double check that you are signed in the Horizon interface as **`default:aliceanderson:fa5tpa55w0rd`**. In case you forgot, the Horizon interface is available via http://controller/horizon

    > If you are struggling to figure out how to determine who you are signed into Horizon as, check the upper right corner. It should be displaying that the signed in user is **aliceanderson**.
    
0. **Click on Project > Compute > Instances**

0. In the upper right corner, **click 'Launch Instance'** 

    ![launch instance](https://alta3.com/labs/images/alta3_lab_create_VM_in_horizon.png)

0. The Launch Instance dialog box will pop up. Fill out each tab as follows:

    >
      **Details Tab**
    >
      Instance Name: acme_vm1
    >
      Availability Zone: nova
    >
      Count: 1
    >
      **Source**
    >
      Select Boot Source: Image (from drop down menu)
    >
      Create New Volume: No
    >
      Allocated: cirros (selected by pressing the + button)
    >
      **Flavor**
    >
      Allocated: m1.tiny (selected by pressing the + button)
    >
      **Networks**
    >
      Allocated: provider-net (selected by pressing the + button)
    >
      **Network Ports**
    >
      (No changes)
    >
      **Security Groups**
    >
      (No changes)
    >
      **Key Pair**
    >
      (No changes)
    >
      **Configuration**
    >
      (No changes)
    >
      **Metadata**
    >
    (No changes)
    >
    
0. Once complete, **Click 'Launch'**. 

0. Did you take time to fully investigate the flavor tab? Just in case you missed it, take a look at the following screenshot, and notice that Alice is unable to launch a machine with the m1.large or m1.xlarge flavors. This is due to an insufficent quota definition for the acme_inc project.

    ![flavor error](https://alta3.com/labs/images/alta3_lab_create_VM_in_horizon_error.png)

0. Immediately upon launching the instance (virtual machine), it will begin spawning. How long the instance takes to spawn is completely dependent on how many resources the instance has been created with, and how the the underlying OpenStack architecture has been designed. Thankfully, the Alta3 Research datacenter is strapped with killer hardware, so it shouldn't take too long at all :p
    
    ![spawning instance](https://alta3.com/labs/images/alta3_lab_create_VM_in_horizon_spawning.png)

0. Once the instance changes from 'Spawning' to 'Running', **sign out of the aliceanderson account**

0. Log in to Horizon as **`default:bobbarker:fa5tpa55w0rd`**

0. Click on **Project > Compute > Overview**

    > You should see the same total available resources that the account aliceanderson saw. Remember, both Alice and Bob are part of the same project (acme_inc)

0. **Click on Project > Compute > Instances**

    > You should still see the same instance that the account aliceanderson saw. Again, both Alice and Bob are part of the same project (acme_inc)

0. Logged in as bobbarker, **click on the 'Launch Instance' button**, then create the following instance:

    >
      **Details Tab**
    >
      Instance Name: acme_vm2
    >
      Availability Zone: nova
    >
      Count: 1
    >
      **Source**
    >
      Select Boot Source: Image (from drop down menu)
    >
      Create New Volume: No
    >
      Allocated: cirros (selected by pressing the + button)
    >
      **Flavor**
    >
      Allocated: m1.tiny (selected by pressing the + button)
    >
      **Networks**
    >
      Allocated: provider-net (selected by pressing the + button)
    >
      **Network Ports**
    >
      (No changes)
    >
      **Security Groups**
    >
      (No changes)
    >
      **Key Pair**
    >
      (No changes)
    >
      **Configuration**
    >
      (No changes)
    >
      **Metadata**
    >
    (No changes)
    >

0. Once complete, **click the 'Launch' button**, and wait for the acme_vm2 instance to finish spawning (this should only take seconds).

0. Once acme_vm2 is running, **click on Project > Compute > Overview**

    > Spend a few minutes checking out this screen. Notice that no more instances or VCPUs are available for this project. It should look similar to the screen shot below:

    ![maxed out](https://alta3.com/labs/images/alta3_lab_create_VM_in_horizon_quota_max.png)
    
0. Would aliceanderson see the same statistics displayed on 'her' overview screen? Find out! Sign out or Horizon as **bobbarker** and sign back into horizon as **default:aliceanderson:fa5tpa55w0rd**

0. **Click on Project > Compute > Overview** and you'll see that the user aliceanderson has exactly the same overview screen as bobbarker! This is because they are both part of the same project.

0. Great job! That concludes this lab.

#### Additional Learning / References

The following are a list of pages we thought might be helpful for our students to know about:

* [Defining SSH Keys](https://winscp.net/eng/docs/ssh_keys)

* [Using Public Keys for Authentication](https://winscp.net/eng/docs/public_key)
